{% extends "base.html" %}

{% block content %}
<div>
    <h1 class="text-3xl font-bold text-white">Dashboard</h1>
    <p class="mt-2 text-lg text-gray-400">En översikt av din hälsoresa.</p>
</div>

<!-- Stat-kort -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Senaste Vikt -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-emerald-500 bg-opacity-20">
                <svg class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div class="ml-4">
                <p class="text-sm font-medium text-gray-400">Vikt idag</p>
                {% if weight_stats.latest_weight %}
                    <p class="text-2xl font-bold text-white">{{ weight_stats.latest_weight }} kg</p>
                {% else %}
                    <p class="text-2xl font-bold text-white">-</p>
                {% endif %}
            </div>
        </div>
        <div class="mt-4">
            {% if weight_stats.change_since_week_ago is not none %}
                <p class="text-sm {{ 'text-green-400' if weight_stats.change_since_week_ago < 0 else 'text-red-400' }}">
                    {{ "%.2f"|format(weight_stats.change_since_week_ago) }} kg denna vecka
                </p>
            {% else %}
                <p class="text-sm text-gray-500">Logga mer data</p>
            {% endif %}
        </div>
    </div>

    <!-- Kalorier Idag -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <div class="flex items-center">
            <div class="p-3 rounded-full bg-emerald-500 bg-opacity-20">
                <svg class="h-6 w-6 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <div class="ml-4">
                <p class="text-sm font-medium text-gray-400">Kalorier</p>
                <p class="text-2xl font-bold text-white">{{ "%.0f"|format(calorie_stats.total_calories) }}</p>
            </div>
        </div>
        <div class="mt-4">
            <div class="w-full bg-gray-700 rounded-full h-2.5">
                <div class="bg-emerald-500 h-2.5 rounded-full" style="width: {{ calorie_stats.progress_percentage }}%"></div>
            </div>
            <p class="text-sm text-gray-400 mt-1">{{ "%.0f"|format(calorie_stats.remaining_calories) }} kvar av {{ "%.0f"|format(calorie_stats.calorie_goal) }}</p>
        </div>
    </div>

    <!-- Träning (platshållare) -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg opacity-50">
         <h3 class="text-lg font-semibold text-gray-300">Träning</h3>
         <p class="text-3xl font-bold text-white mt-2">Kommer snart</p>
         <p class="text-sm text-gray-500 mt-1">Funktion under utveckling</p>
    </div>

    <!-- TDEE (platshållare) -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg opacity-50">
         <h3 class="text-lg font-semibold text-gray-300">TDEE</h3>
         <p class="text-3xl font-bold text-white mt-2">Kommer snart</p>
         <p class="text-sm text-gray-500 mt-1">Funktion under utveckling</p>
    </div>
</div>

<!-- Viktgraf -->
<div class="mt-8 bg-gray-800 p-6 rounded-lg shadow-lg">
    <h3 class="text-xl font-bold text-white mb-4">Viktutveckling (30 dagar)</h3>
    <canvas id="weightChart"></canvas>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('weightChart').getContext('2d');
    
    // Hämta data från Flask
    const labels = {{ chart_labels|tojson }};
    const data = {{ chart_values|tojson }};

    if (data.length > 0) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Vikt (kg)',
                    data: data,
                    backgroundColor: 'rgba(20, 184, 166, 0.2)',
                    borderColor: 'rgba(20, 184, 166, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(20, 184, 166, 1)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#d1d5db' }
                    },
                    x: {
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#d1d5db' }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#d1d5db'
                        }
                    }
                }
            }
        });
    } else {
        // Visa ett meddelande om ingen data finns
        const canvas = document.getElementById('weightChart');
        const parent = canvas.parentElement;
        canvas.remove();
        const p = document.createElement('p');
        p.textContent = 'Logga din vikt för att se en graf här.';
        p.className = 'text-center text-gray-500 py-8';
        parent.appendChild(p);
    }
});
</script>
{% endblock %}
