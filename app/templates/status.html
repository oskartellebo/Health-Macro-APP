{% extends "base.html" %}

{% block content %}
<div class="space-y-8">
    <div>
        <h1 class="text-3xl font-bold text-white">Status</h1>
        <p class="mt-2 text-lg text-gray-400">En sammanfattning av din hälsa och dina framsteg.</p>
    </div>

    <!-- Sektion: Vikt-Sammanfattning -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <div class="flex flex-wrap justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-white">⚖️ Viktutveckling</h2>
            <div id="interval-buttons" class="flex space-x-2">
                <button data-interval="7" class="px-3 py-1 text-sm font-medium text-white bg-gray-700 rounded-md hover:bg-teal-600">7D</button>
                <button data-interval="30" class="px-3 py-1 text-sm font-medium text-white bg-teal-600 rounded-md hover:bg-teal-600">30D</button>
                <button data-interval="90" class="px-3 py-1 text-sm font-medium text-white bg-gray-700 rounded-md hover:bg-teal-600">90D</button>
                <button data-interval="365" class="px-3 py-1 text-sm font-medium text-white bg-gray-700 rounded-md hover:bg-teal-600">365D</button>
                <button data-interval="all" class="px-3 py-1 text-sm font-medium text-white bg-gray-700 rounded-md hover:bg-teal-600">Allt</button>
            </div>
        </div>
        <div class="h-96">
            <canvas id="statusWeightChart"></canvas>
        </div>
    </div>

    <!-- Sektion: Kalori & Makro -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold text-white mb-4">🍎 Kostsammanfattning</h2>
        <p class="text-gray-400">Genomsnittligt kaloriintag och makrofördelning kommer snart.</p>
    </div>

    <!-- Sektion: Träning -->
    <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold text-white mb-4">💪 Träningssammanfattning</h2>
        <p class="text-gray-400">Summering av steg, kondition och ronder kommer snart.</p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('statusWeightChart').getContext('2d');
    let weightChart;

    async function fetchAndUpdateChart(period = '30') {
        try {
            const response = await fetch(`/api/weight-data?period=${period}`);
            if (!response.ok) {
                throw new Error('Nätverkssvar var inte ok');
            }
            const chartData = await response.json();

            if (weightChart) {
                weightChart.destroy();
            }

            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: chartData.labels,
                    datasets: [{
                        label: 'Vikt (kg)',
                        data: chartData.data,
                        backgroundColor: 'rgba(20, 184, 166, 0.2)',
                        borderColor: 'rgba(20, 184, 166, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(20, 184, 166, 1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#d1d5db' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#d1d5db' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#d1d5db' } }
                    }
                }
            });
        } catch (error) {
            console.error('Kunde inte hämta eller rita graf:', error);
        }
    }

    const buttons = document.querySelectorAll('#interval-buttons button');
    buttons.forEach(button => {
        button.addEventListener('click', function() {
            buttons.forEach(btn => btn.classList.remove('bg-teal-600'));
            this.classList.add('bg-teal-600');
            const interval = this.dataset.interval;
            fetchAndUpdateChart(interval);
        });
    });

    // Ladda initial graf
    fetchAndUpdateChart('30');
});
</script>
{% endblock %} 